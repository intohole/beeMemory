# 系统优化与测试计划

## 一、系统清理与重置

1. **停止当前服务**
   - 停止uvicorn服务
   - 停止HTTP服务器

2. **清理数据目录**
   - 删除data目录下的所有文件
   - 删除chroma_data目录
   - 删除memory.db文件

3. **创建新的数据目录**
   - 重新创建data目录

## 二、配置更新

1. **更新数据库配置**
   - 确保数据库URL指向data目录：`sqlite:///./data/memory.db`

2. **更新Chroma配置**
   - 配置远程Chroma服务：
     - `host`: 远程Chroma服务器地址
     - `port`: 远程Chroma服务器端口
     - `use_persistent_client`: false

## 三、系统重新启动

1. **启动uvicorn服务**
   - 运行：`python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8080 --reload`

2. **启动HTTP服务器**
   - 运行：`python3 -m http.server 8081 --directory app/static`

## 四、功能测试

1. **数据库初始化测试**
   - 检查data目录下是否创建了memory.db文件
   - 检查是否成功创建了所有数据库表

2. **API路由测试**
   - 测试所有核心路由：
     - GET /api/memory/app/config
     - POST /api/memory/submit
     - POST /api/memory/query
     - GET /api/memory/list
     - DELETE /api/memory/{memory_id}
     - 优先级相关路由
     - 手动操作相关路由

3. **Chroma连接测试**
   - 测试Chroma连接是否正常
   - 测试向量存储和查询功能

4. **端到端测试**
   - 提交聊天历史，生成记忆
   - 查询相似记忆
   - 管理记忆（归档、取消归档、更新优先级等）
   - 管理应用配置

## 五、代码修复

1. **修复insert_sample_data.py**
   - 移除对MemoryEmbedding和UserAppConfig的引用
   - 简化示例数据插入逻辑

2. **修复API路由**
   - 确保所有路由正常响应
   - 修复错误处理
   - 优化参数验证

3. **修复Chroma客户端**
   - 确保远程Chroma连接正常
   - 修复向量存储和查询逻辑

## 六、测试报告

1. **生成测试报告**
   - 记录所有测试结果
   - 列出发现的问题和修复方案
   - 验证所有功能是否正常工作

## 七、最终验证

1. **确保所有功能可用**
   - 对话列表功能
   - 记忆列表功能
   - APP配置功能
   - 优先级管理功能
   - 记忆查询功能
   - 记忆管理功能

2. **性能测试**
   - 测试API响应时间
   - 测试向量查询性能
   - 测试记忆生成速度

3. **稳定性测试**
   - 长时间运行测试
   - 并发请求测试
   - 异常情况处理测试